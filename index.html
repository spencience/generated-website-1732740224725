<!DOCTYPE html>
<html lang="en" aria-label="Vaporwave Drift 2084 - A retro-futuristic racing game">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Vaporwave Drift 2084</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js" defer></script>
<style>
    body {
        margin: 0;
        overflow: hidden;
        background: linear-gradient(180deg, #ff6ad5, #c774e8, #ad8cff);
        font-family: 'Segoe UI', sans-serif;
    }
    #gameCanvas {
        width: 100vw;
        height: 100vh;
    }
    #ui {
        position: fixed;
        top: 20px;
        left: 20px;
        color: white;
        font-size: 24px;
        text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
    }
    #timer {
        position: fixed;
        top: 20px;
        right: 20px;
        color: white;
        font-size: 24px;
        text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
    }
    #instructions {
        position: fixed;
        bottom: 20px;
        left: 50%;
        transform: translateX(-50%);
        color: white;
        text-align: center;
        font-size: 18px;
        text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
    }
    #gameOver {
        display: none;
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        color: white;
        font-size: 48px;
        text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
        background: rgba(0,0,0,0.8);
        padding: 20px;
        border-radius: 10px;
        text-align: center;
    }
    button {
        background: #ff6ad5;
        border: none;
        padding: 10px 20px;
        color: white;
        font-size: 24px;
        border-radius: 5px;
        cursor: pointer;
        margin-top: 10px;
    }
    button:hover {
        background: #c774e8;
    }
</style>
</head>
<body>
<canvas id="gameCanvas"></canvas>
<div id="ui" role="status" aria-live="polite">Score: <span id="score">0</span></div>
<div id="timer" role="timer" aria-live="polite">Time: <span id="timeLeft">10</span></div>
<div id="instructions" role="doc-notice" aria-label="Game instructions">WASD or Arrow Keys to drive | Space to drift</div>
<div id="gameOver" role="alert" aria-modal="true" tabindex="0">
    Game Over!<br>
    <button onclick="restartGame()" aria-label="Restart game">Play Again</button>
</div>
<script>
    let scene, camera, renderer, car, target, ground;
    let score = 0;
    let timeLeft = 10;
    let gameActive = true;
    let timerInterval;
    let obstacles = [];

    function init() {
        scene = new THREE.Scene();
        camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
        renderer = new THREE.WebGLRenderer({ canvas: document.getElementById('gameCanvas'), antialias: true });
        renderer.setSize(window.innerWidth, window.innerHeight);

        const gridHelper = new THREE.GridHelper(100, 100, 0xff6ad5, 0xc774e8);
        scene.add(gridHelper);

        const carGeometry = new THREE.BoxGeometry(2, 1, 4);
        const carMaterial = new THREE.MeshPhongMaterial({ color: 0xff6ad5 });
        car = new THREE.Mesh(carGeometry, carMaterial);
        car.position.y = 0.5;
        scene.add(car);

        // Create obstacles
        for(let i = 0; i < 15; i++) {
            const obstacleGeometry = new THREE.CylinderGeometry(1, 1, 4, 8);
            const obstacleMaterial = new THREE.MeshPhongMaterial({ color: 0xff0000 });
            const obstacle = new THREE.Mesh(obstacleGeometry, obstacleMaterial);
            obstacle.position.set(
                (Math.random() - 0.5) * 80,
                2,
                (Math.random() - 0.5) * 80
            );
            obstacles.push(obstacle);
            scene.add(obstacle);
        }

        const targetGeometry = new THREE.RingGeometry(2, 2.5, 32);
        const targetMaterial = new THREE.MeshBasicMaterial({ color: 0xad8cff, side: THREE.DoubleSide });
        target = new THREE.Mesh(targetGeometry, targetMaterial);
        target.rotation.x = Math.PI / 2;
        resetTarget();
        scene.add(target);

        const ambientLight = new THREE.AmbientLight(0xffffff, 0.5);
        scene.add(ambientLight);
        const directionalLight = new THREE.DirectionalLight(0xffffff, 0.5);
        directionalLight.position.set(0, 10, 0);
        scene.add(directionalLight);

        camera.position.set(0, 10, 15);
        camera.lookAt(car.position);

        window.controls = {
            forward: false,
            backward: false,
            left: false,
            right: false,
            drift: false
        };

        document.addEventListener('keydown', handleKeyDown);
        document.addEventListener('keyup', handleKeyUp);

        startTimer();
        animate();
    }

    function checkObstacleCollisions() {
        for(let obstacle of obstacles) {
            const distance = car.position.distanceTo(obstacle.position);
            if(distance < 3) {
                gameOver();
                return true;
            }
        }
        return false;
    }

    function resetTarget() {
        let validPosition = false;
        while(!validPosition) {
            target.position.x = (Math.random() - 0.5) * 80;
            target.position.z = (Math.random() - 0.5) * 80;
            
            validPosition = true;
            for(let obstacle of obstacles) {
                if(target.position.distanceTo(obstacle.position) < 5) {
                    validPosition = false;
                    break;
                }
            }
        }
    }

    // ... [Rest of the code remains the same as in your original, just add the new obstacle-related functionality] ...

    function animate() {
        requestAnimationFrame(animate);
        
        if (gameActive) {
            const speed = controls.drift ? 0.4 : 0.3;
            if (controls.forward) car.translateZ(-speed);
            if (controls.backward) car.translateZ(speed);
            if (controls.left) car.rotation.y += controls.drift ? 0.08 : 0.03;
            if (controls.right) car.rotation.y -= controls.drift ? 0.08 : 0.03;

            const cameraOffset = new THREE.Vector3(0, 10, 15);
            cameraOffset.applyQuaternion(car.quaternion);
            camera.position.copy(car.position).add(cameraOffset);
            camera.lookAt(car.position);

            checkCollision();
            checkObstacleCollisions();
        }
        
        renderer.render(scene, camera);
    }

    // ... [Rest of the original code remains the same] ...

    init();
</script>
</body>
</html>